<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Minesweeper Game</title>
    <style>
        body {
            background: #222;
            color: #fff;
            text-align: center;
            font-family: Arial, sans-serif;
            margin: 0;
        }

        h1 {
            margin: 24px 0 8px 0;
        }

        #gameBoard {
            display: grid;
            grid-template-columns: repeat(16, 32px);
            grid-template-rows: repeat(16, 32px);
            gap: 2px;
            justify-content: center;
            margin: 30px auto 16px;
            width: max-content;
        }

        .cell {
            background: #444;
            color: #fff;
            font-size: 1.2em;
            font-weight: bold;
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 32px;
            width: 32px;
            cursor: pointer;
            user-select: none;
            transition: background 0.1s;
            border: 1px solid #222;
        }

        .cell.revealed {
            background: #ddd;
            color: #222;
            cursor: default;
        }

        .cell.mine.revealed {
            background: #f00;
            color: #fff;
        }

        .cell.flagged {
            background: #ffd700;
            color: #222;
        }

        .scoreboard {
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .message {
            font-size: 1.5em;
            color: #ffd700;
            min-height: 28px;
            margin: 12px;
            font-weight: bold;
        }

        #restartBtn {
            display: none;
            padding: 10px 24px;
            font-size: 1.1em;
            background: #ffd700;
            border: none;
            border-radius: 5px;
            color: #222;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }
    </style>
</head>

<body>
    <h1>Minesweeper</h1>
    <div class="scoreboard">
        <span id="minesLeft"></span>
    </div>
    <div class="message" id="message"></div>
    <div id="gameBoard"></div>
    <button id="restartBtn">Restart Game</button>
    <script>
        // Game settings
        const size = 16;
        const mineCount = 40;
        let board = [];
        let revealed = [];
        let flagged = [];
        let mines = [];
        let gameOver = false;
        let firstClick = true;
        let cellsRevealed = 0;
        let flagsPlaced = 0;
        const boardEl = document.getElementById('gameBoard');
        const messageEl = document.getElementById('message');
        const restartBtn = document.getElementById('restartBtn');
        const minesLeftEl = document.getElementById('minesLeft');

        function initGame() {
            board = Array(size).fill().map(() => Array(size).fill(0));
            revealed = Array(size).fill().map(() => Array(size).fill(false));
            flagged = Array(size).fill().map(() => Array(size).fill(false));
            mines = [];
            gameOver = false;
            firstClick = true;
            cellsRevealed = 0;
            flagsPlaced = 0;
            messageEl.textContent = '';
            restartBtn.style.display = 'none';
            updateMinesLeft();
            renderBoard();
        }

        function placeMines(safeR, safeC) {
            let allCells = [];
            for (let r = 0; r < size; r++) for (let c = 0; c < size; c++)
                if (!(Math.abs(r - safeR) <= 1 && Math.abs(c - safeC) <= 1)) allCells.push({ r, c });
            allCells = shuffle(allCells);
            mines = allCells.slice(0, mineCount);
            for (let { r, c } of mines) {
                board[r][c] = 'M';
            }
            // Calculate numbers
            for (let r = 0; r < size; r++) for (let c = 0; c < size; c++) {
                if (board[r][c] === 'M') continue;
                let count = 0;
                for (let dr = -1; dr <= 1; dr++) for (let dc = -1; dc <= 1; dc++) {
                    let nr = r + dr, nc = c + dc;
                    if (nr >= 0 && nr < size && nc >= 0 && nc < size && board[nr][nc] === 'M') count++;
                }
                board[r][c] = count;
            }
        }

        function shuffle(arr) {
            for (let i = arr.length - 1; i > 0; i--) {
                let j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }

        function renderBoard() {
            boardEl.innerHTML = '';
            for (let r = 0; r < size; r++) for (let c = 0; c < size; c++) {
                const cellEl = document.createElement('div');
                cellEl.className = 'cell';
                if (revealed[r][c]) {
                    cellEl.classList.add('revealed');
                    if (board[r][c] === 'M') {
                        cellEl.classList.add('mine');
                        cellEl.textContent = 'ðŸ’£';
                    } else if (board[r][c] > 0) {
                        cellEl.textContent = board[r][c];
                        cellEl.style.color = ['#1976d2', '#388e3c', '#d32f2f', '#fbc02d', '#8e24aa', '#00838f', '#5d4037', '#c62828'][board[r][c] - 1];
                    }
                } else if (flagged[r][c]) {
                    cellEl.classList.add('flagged');
                    cellEl.textContent = 'ðŸš©';
                }
                cellEl.addEventListener('click', (e) => handleCellClick(r, c, e));
                cellEl.addEventListener('contextmenu', (e) => flagCell(r, c, e));
                boardEl.appendChild(cellEl);
            }
        }

        function handleCellClick(r, c, e) {
            if (gameOver || flagged[r][c] || revealed[r][c]) return;
            if (firstClick) {
                placeMines(r, c);
                firstClick = false;
            }
            revealCell(r, c);
            renderBoard();
            checkWin();
        }

        function flagCell(r, c, e) {
            e.preventDefault();
            if (gameOver || revealed[r][c]) return;
            flagged[r][c] = !flagged[r][c];
            flagsPlaced += flagged[r][c] ? 1 : -1;
            updateMinesLeft();
            renderBoard();
            checkWin();
        }

        function revealCell(r, c) {
            if (revealed[r][c] || flagged[r][c]) return;
            revealed[r][c] = true;
            cellsRevealed++;
            if (board[r][c] === 'M') {
                messageEl.textContent = "Game Over! You hit a mine ðŸ’¥";
                revealAllMines();
                restartBtn.style.display = "inline-block";
                gameOver = true;
                return;
            }
            if (board[r][c] === 0) {
                // Reveal neighbors
                for (let dr = -1; dr <= 1; dr++) for (let dc = -1; dc <= 1; dc++) {
                    let nr = r + dr, nc = c + dc;
                    if (nr >= 0 && nr < size && nc >= 0 && nc < size && !revealed[nr][nc]) {
                        revealCell(nr, nc);
                    }
                }
            }
        }

        function revealAllMines() {
            for (let { r, c } of mines) revealed[r][c] = true;
            renderBoard();
        }

        function checkWin() {
            if (gameOver) return;
            if (cellsRevealed === size * size - mineCount) {
                messageEl.textContent = "You Win! ðŸŽ‰";
                restartBtn.style.display = "inline-block";
                gameOver = true;
            }
        }

        function updateMinesLeft() {
            minesLeftEl.textContent = `Mines left: ${mineCount - flagsPlaced}`;
        }

        restartBtn.addEventListener('click', initGame);

        initGame();
    </script>
</body>

</html>
